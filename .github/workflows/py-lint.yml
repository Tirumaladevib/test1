name: Reusable workflow

on:
  workflow_call:
    # Map the workflow outputs to job outputs
    inputs:
      workflow_id:
         required: true
         type: string
         description: "ID or filename of the workflow to get latest successful commit"
      files_to_match:
         description: "Check for changes using only this list of files or regex (Defaults to the entire repo)"
         required: true
         type: string   
    secrets:
      gh_token:
         required:  true

jobs:
  changed_py_files_job:
   runs-on: ubuntu-latest
   outputs:
     changed_files: ${{ steps.changed-files.outputs.changed_files }}
     any_changed: ${{ steps.changed-files.outputs.any_changed }}
   
   steps:
   - uses: actions/checkout@v2
     with:
       fetch-depth: 0  
   
   - name: Get changed tf files
     id: changed-files
     uses: ./test1/changed-files-since-last-success
     with:
       files_to_match: ${{ inputs.files_to_match }}
       github_token: ${{ secrets.gh_token }}
       workflow_id: ${{ inputs.workflow_id }}    
   
  pylint_job:
    runs-on: ubuntu-latest
    needs: changed_py_files_job
    if: needs.changed_py_files_job.outputs.any_changed == 'true'
    steps:
      - uses: actions/checkout@v2

      - name: Python Pylint Github Action
        uses: fylein/python-pylint-github-action@master
        with:
           args: pylint ${{ needs.changed_py_files_job.outputs.changed_files }}
      - name: testing
        if: always()
        run: |
             echo ${{ needs.changed_py_files_job.outputs.changed_files }}
             echo ${{ needs.changed_py_files_job.outputs.any_changed }}
      
